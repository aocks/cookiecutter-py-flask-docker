
* Introduction

This project provides a [[https://github.com/cookiecutter/cookiecutter][cookiecutter]] template for a dockerized project
for a python flask web server managed using an nginx reverse proxy.

The basic idea is to give you a simple way to start a new python
project which contains a web app (for browsers, APIs, or whatever)
with a few simple commands.

Ideally you should just be able to issue a command like

- =cookiecutter gh:aocks/cookiecutter-py-flask-docker=

and answer a few questions to get the skeleton for a web application
including things like:

- linting, testing, type checking
- docker-compose to run nginx and your flask application
- deployment scripts
- command line utilities

* Quickstart

First make sure you have [[https://github.com/cookiecutter/cookiecutter][cookiecutter]] installed. If not, you can
install [[https://github.com/cookiecutter/cookiecutter][cookiecutter]] via something like the following:
#+NAME: cpfd-install-cookiecutter
#+BEGIN_SRC shell :session show-cpfd :exports code
cd /tmp                   # work in tmp dir to illustrate example
python3 -m venv venv      # create a virtualenv
. venv/bin/activate       # and activate it
pip install cookiecutter  # so you can install cookiecutter
#+END_SRC


Once you have [[https://github.com/cookiecutter/cookiecutter][cookiecutter]] installed, use it with this template via:
#+NAME: cpfd-run-cookiecutter
#+BEGIN_SRC shell :session show-cpfd :exports code
cookiecutter gh:aocks/cookiecutter-py-flask-docker  
#+END_SRC
and answer the questions. The following are some details about how the
fields requested and what they are used for:

- =github_username=:
  - This can be either your username or the name of your
    organization. 
- =project_slug=:
  - This will determine the name of your new project directory and is
    auto-generated from your project name to be allow lowercase with
    no space or hyphens.

Once you are done, [[https://github.com/cookiecutter/cookiecutter][cookiecutter]] will create a new directory for you
based on the =project_slug= value you specified. This directory has
everything you need for your python project. You can just do the
following to build and deploy docker containers to local ports (9080
for HTTP and 9443 for SSL by default) for testing:
#+NAME: cpfd-local-deploy
#+BEGIN_SRC shell :session show-cpfd
cd python_boilerplate  # or whateer your project slug was
make local_deploy
#+END_SRC

You can then verify that the flask server is up via
#+NAME: cpfd-flask-health-check
#+BEGIN_SRC shell :session show-cpfd
curl localhost:9080/flask-health-check
#+END_SRC
or point your browser to http://localhost:9080. You can bring down the
docker containers via
#+NAME: cpfd-down
#+BEGIN_SRC shell :session show-cpfd
make docker_down
#+END_SRC

If you want to deploy for production on the usual ports, you can do
#+NAME: cpfd-deploy
#+BEGIN_SRC shell :session show-cpfd
make deploy
#+END_SRC
and verify via
#+NAME: cpfd-flask-health-check-production
#+BEGIN_SRC shell :session show-cpfd
curl localhost:80/flask-health-check
#+END_SRC

Of course, this flask server does not do much so once you have your
cookiecutter template, you will probably want to look at the files in
=/apps/webui/= and modify them for your application.

* Usage and Features

This section describes usage and features of this cookiecutter
template.

** Checking

Doing =make check= in the top-level project directory will run various
checks including linting to check code style, pytype to check type
usage, and finally regression tests.

You should do =make check= regularly and fix any errors in order to
maintain high quality code.

* Implementation

This section describes the implementation details of how this
cookiecutter template works. It is mainly of interesting if you want
to extend the template. If you just want to use it, you can skip this
section.

